{{ config(
    indexes = [{'columns':['_airbyte_emitted_at'],'type':'btree'}],
    unique_key = '_airbyte_ab_id',
    schema = "_airbyte_public",
    tags = [ "top-level-intermediate" ]
) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
-- depends_on: {{ source('public', '_airbyte_raw_date_convertor') }}
select
    {{ json_extract_scalar('_airbyte_data', ['_id'], ['_id']) }} as _id,
    {{ json_extract_scalar('_airbyte_data', ['cq3'], ['cq3']) }} as cq3,
    {{ json_extract_scalar('_airbyte_data', ['cq7'], ['cq7']) }} as cq7,
    {{ json_extract_scalar('_airbyte_data', ['cq8'], ['cq8']) }} as cq8,
    {{ json_extract_scalar('_airbyte_data', ['cq9'], ['cq9']) }} as cq9,
    {{ json_extract_scalar('_airbyte_data', ['cq10'], ['cq10']) }} as cq10,
    {{ json_extract_scalar('_airbyte_data', ['cq16'], ['cq16']) }} as cq16,
    {{ json_extract_scalar('_airbyte_data', ['cq4t'], ['cq4t']) }} as cq4t,
    {{ json_extract_scalar('_airbyte_data', ['cq10a'], ['cq10a']) }} as cq10a,
    {{ json_extract_scalar('_airbyte_data', ['cq10b'], ['cq10b']) }} as cq10b,
    {{ json_extract_scalar('_airbyte_data', ['cq13b'], ['cq13b']) }} as cq13b,
    {{ json_extract_scalar('_airbyte_data', ['queue'], ['queue']) }} as queue,
    {{ json_extract_scalar('_airbyte_data', ['region'], ['region']) }} as region,
    {{ json_extract_scalar('_airbyte_data', ['status'], ['status']) }} as status,
    {{ json_extract_scalar('_airbyte_data', ['severity'], ['severity']) }} as severity,
    {{ json_extract_scalar('_airbyte_data', ['bug_cases'], ['bug_cases']) }} as bug_cases,
    {{ json_extract_scalar('_airbyte_data', ['case_type'], ['case_type']) }} as case_type,
    {{ json_extract_scalar('_airbyte_data', ['defect_id'], ['defect_id']) }} as defect_id,
    {{ json_extract_scalar('_airbyte_data', ['asset_name'], ['asset_name']) }} as asset_name,
    {{ json_extract_scalar('_airbyte_data', ['case_owner'], ['case_owner']) }} as case_owner,
    {{ json_extract_scalar('_airbyte_data', ['openedDate'], ['openedDate']) }} as openeddate,
    {{ json_extract_scalar('_airbyte_data', ['case_number'], ['case_number']) }} as case_number,
    {{ json_extract_scalar('_airbyte_data', ['case_origin'], ['case_origin']) }} as case_origin,
    {{ json_extract_scalar('_airbyte_data', ['account_name'], ['account_name']) }} as account_name,
    {{ json_extract_scalar('_airbyte_data', ['federal_case'], ['federal_case']) }} as federal_case,
    {{ json_extract_scalar('_airbyte_data', ['product_line'], ['product_line']) }} as product_line,
    {{ json_extract_scalar('_airbyte_data', ['case_category'], ['case_category']) }} as case_category,
    {{ json_extract_scalar('_airbyte_data', ['customer_type'], ['customer_type']) }} as customer_type,
    {{ json_extract_scalar('_airbyte_data', ['handover_type'], ['handover_type']) }} as handover_type,
    {{ json_extract_scalar('_airbyte_data', ['loyalty_index'], ['loyalty_index']) }} as loyalty_index,
    {{ json_extract_scalar('_airbyte_data', ['product_group'], ['product_group']) }} as product_group,
    {{ json_extract_scalar('_airbyte_data', ['exclusion_flag'], ['exclusion_flag']) }} as exclusion_flag,
    {{ json_extract_scalar('_airbyte_data', ['previous_owner'], ['previous_owner']) }} as previous_owner,
    {{ json_extract_scalar('_airbyte_data', ['product_number'], ['product_number']) }} as product_number,
    {{ json_extract_scalar('_airbyte_data', ['requestor_lang'], ['requestor_lang']) }} as requestor_lang,
    {{ json_extract_scalar('_airbyte_data', ['Escalation_Date'], ['Escalation_Date']) }} as escalation_date,
    {{ json_extract_scalar('_airbyte_data', ['customer_domain'], ['customer_domain']) }} as customer_domain,
    {{ json_extract_scalar('_airbyte_data', ['customer_ref_id'], ['customer_ref_id']) }} as customer_ref_id,
    {{ json_extract_scalar('_airbyte_data', ['detailed_status'], ['detailed_status']) }} as detailed_status,
    {{ json_extract_scalar('_airbyte_data', ['escalation_date'], ['escalation_date']) }} as escalation_date_1,
    {{ json_extract_scalar('_airbyte_data', ['escalation_flag'], ['escalation_flag']) }} as escalation_flag,
    {{ json_extract_scalar('_airbyte_data', ['resolution_code'], ['resolution_code']) }} as resolution_code,
    {{ json_extract_scalar('_airbyte_data', ['resolution_date'], ['resolution_date']) }} as resolution_date,
    {{ json_extract_scalar('_airbyte_data', ['case_subcategory'], ['case_subcategory']) }} as case_subcategory,
    {{ json_extract_scalar('_airbyte_data', ['date_time_closed'], ['date_time_closed']) }} as date_time_closed,
    {{ json_extract_scalar('_airbyte_data', ['date_time_opened'], ['date_time_opened']) }} as date_time_opened,
    {{ json_extract_scalar('_airbyte_data', ['entitlement_type'], ['entitlement_type']) }} as entitlement_type,
    {{ json_extract_scalar('_airbyte_data', ['escalation_tier1'], ['escalation_tier1']) }} as escalation_tier1,
    {{ json_extract_scalar('_airbyte_data', ['escalation_tier2'], ['escalation_tier2']) }} as escalation_tier2,
    {{ json_extract_scalar('_airbyte_data', ['escalation_tier3'], ['escalation_tier3']) }} as escalation_tier3,
    {{ json_extract_scalar('_airbyte_data', ['escalation_tier4'], ['escalation_tier4']) }} as escalation_tier4,
    {{ json_extract_scalar('_airbyte_data', ['highest_severity'], ['highest_severity']) }} as highest_severity,
    {{ json_extract_scalar('_airbyte_data', ['physical_country'], ['physical_country']) }} as physical_country,
    {{ json_extract_scalar('_airbyte_data', ['product_category'], ['product_category']) }} as product_category,
    {{ json_extract_scalar('_airbyte_data', ['software_version'], ['software_version']) }} as software_version,
    {{ json_extract_scalar('_airbyte_data', ['availability_flag'], ['availability_flag']) }} as availability_flag,
    {{ json_extract_scalar('_airbyte_data', ['account_page_level'], ['account_page_level']) }} as account_page_level,
    {{ json_extract_scalar('_airbyte_data', ['case_contact_email'], ['case_contact_email']) }} as case_contact_email,
    {{ json_extract_scalar('_airbyte_data', ['case_owner_manager'], ['case_owner_manager']) }} as case_owner_manager,
    {{ json_extract_scalar('_airbyte_data', ['overall_experience'], ['overall_experience']) }} as overall_experience,
    {{ json_extract_scalar('_airbyte_data', ['parent_case_number'], ['parent_case_number']) }} as parent_case_number,
    {{ json_extract_scalar('_airbyte_data', ['resolution_subcode'], ['resolution_subcode']) }} as resolution_subcode,
    {{ json_extract_scalar('_airbyte_data', ['entitlement_summary'], ['entitlement_summary']) }} as entitlement_summary,
    {{ json_extract_scalar('_airbyte_data', ['part_arrived_ontime'], ['part_arrived_ontime']) }} as part_arrived_ontime,
    {{ json_extract_scalar('_airbyte_data', ['survey_received_date'], ['survey_received_date']) }} as survey_received_date,
    {{ json_extract_scalar('_airbyte_data', ['esc_addressed_datetime'], ['esc_addressed_datetime']) }} as esc_addressed_datetime,
    {{ json_extract_scalar('_airbyte_data', ['closedDate_aibyte_transform'], ['closedDate_aibyte_transform']) }} as closeddate_aibyte_transform,
    {{ json_extract_scalar('_airbyte_data', ['resolution_provided_satisfactory'], ['resolution_provided_satisfactory']) }} as resolution_provided_satisfactory,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at
from {{ source('public', '_airbyte_raw_date_convertor') }} as table_alias
-- date_convertor
where 1 = 1

